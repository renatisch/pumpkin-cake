"use strict";var SearchkitDefault=(()=>{var q=Object.create;var x=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var re=Object.getPrototypeOf,ne=Object.prototype.hasOwnProperty;var ie=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),se=(t,e)=>{for(var r in e)x(t,r,{get:e[r],enumerable:!0})},j=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of te(e))!ne.call(t,i)&&i!==r&&x(t,i,{get:()=>e[i],enumerable:!(n=ee(e,i))||n.enumerable});return t};var ae=(t,e,r)=>(r=t!=null?q(re(t)):{},j(e||!t||!t.__esModule?x(r,"default",{value:t,enumerable:!0}):r,t)),oe=t=>j(x({},"__esModule",{value:!0}),t);var I=ie((We,B)=>{"use strict";var ue=function(e){return ce(e)&&!le(e)};function ce(t){return!!t&&typeof t=="object"}function le(t){var e=Object.prototype.toString.call(t);return e==="[object RegExp]"||e==="[object Date]"||he(t)}var ge=typeof Symbol=="function"&&Symbol.for,fe=ge?Symbol.for("react.element"):60103;function he(t){return t.$$typeof===fe}function pe(t){return Array.isArray(t)?[]:{}}function F(t,e){return e.clone!==!1&&e.isMergeableObject(t)?A(pe(t),t,e):t}function de(t,e,r){return t.concat(e).map(function(n){return F(n,r)})}function ye(t,e){if(!e.customMerge)return A;var r=e.customMerge(t);return typeof r=="function"?r:A}function me(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter(function(e){return t.propertyIsEnumerable(e)}):[]}function v(t){return Object.keys(t).concat(me(t))}function N(t,e){try{return e in t}catch{return!1}}function be(t,e){return N(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))}function Ae(t,e,r){var n={};return r.isMergeableObject(t)&&v(t).forEach(function(i){n[i]=F(t[i],r)}),v(e).forEach(function(i){be(t,i)||(N(t,i)&&r.isMergeableObject(e[i])?n[i]=ye(i,r)(t[i],e[i],r):n[i]=F(e[i],r))}),n}function A(t,e,r){r=r||{},r.arrayMerge=r.arrayMerge||de,r.isMergeableObject=r.isMergeableObject||ue,r.cloneUnlessOtherwiseSpecified=F;var n=Array.isArray(e),i=Array.isArray(t),o=n===i;return o?n?r.arrayMerge(t,e,r):Ae(t,e,r):F(e,r)}A.all=function(e,r){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(n,i){return A(n,i,r)},{})};var Fe=A;B.exports=Fe});var Le={};se(Le,{ESTransporter:()=>_,MatchFilter:()=>Se,TermFilter:()=>w,default:()=>M});var J=ae(I());var w=(t,e)=>({term:{[t]:e}}),Se=(t,e)=>({match:{[t]:e}});var S=(t,e)=>t.find(n=>typeof n=="string"?n===e:n.attribute===e)||null,Q=t=>typeof t!="string"&&!!t.nestedPath;var H=(t,e)=>{var n;let r=typeof e=="string"?e:e.attribute;return t.includes(r)?"string":((n=t.find(i=>(i==null?void 0:i.attribute)===r))==null?void 0:n.type)||"string"},C=t=>t.reduce((e,r)=>[...e,JSON.stringify({index:r.indexName}),`
`,JSON.stringify(r.body),`
`],[]).join("");var O=(t,e)=>{let{params:r={}}=t,{numericFilters:n}=r;return Array.isArray(n)?n.reduce((i,o)=>{let a,c,l,s,g="",u=o.match(/([\w\.\_\-]+)\s*(\=|\!\=|\>|\>\=|\<|\<\=)\s*(-?\d+)/);if(u)[a,c,l,s]=u;else{if(u=o.match(/([\w\.\_\-]+):\s*(-?\d+)\s*([Tt][Oo])\s*(-?\d+)/),!u)throw new Error(`Numeric filter "${o}" could not be parsed. It should either be in the format "attributeName operator operand" or "attributeName: lowerBound TO upperBound"`);[a,c,s,l,g]=u}let f=R(e.facet_attributes||[],e.filter_attributes||[])[c],p=(y,m,b)=>{if(m==="=")return{term:{[y]:b}};if(m==="!=")return{bool:{must_not:{term:{[y]:b}}}};if(m===">")return{range:{[y]:{gt:b}}};if(m===">=")return{range:{[y]:{gte:b}}};if(m==="<")return{range:{[y]:{lt:b}}};if(m==="<=")return{range:{[y]:{lte:b}}};if(m.toUpperCase()==="TO")return{range:{[y]:{gte:b,lte:g}}}},d=[];if(f.nestedPath){let y=i.find(m=>m.nested.path===f.nestedPath);y?y.nested.query.bool.filter.push(p(f.nestedPath+"."+f.field,l,s)):d.push({nested:{path:f.nestedPath,inner_hits:{},query:{bool:{filter:[p(f.nestedPath+"."+f.field,l,s)]}}}})}else d.push(p(f.field,l,s));return[...i,...d]},[]):[]},R=(t,e)=>[...e,...t].reduce((r,n)=>{let i=typeof n=="string"?{attribute:n,field:n,type:"string"}:n;return{...r,[i.attribute]:i}},{}),D=(t,e)=>{let{params:r={}}=t,{facetFilters:n}=r;if(!Array.isArray(n))return[];let i=R(e.facet_attributes||[],e.filter_attributes||[]);return n.reduce((o,a)=>{if(Array.isArray(a))return[...o,{bool:{should:a.reduce((c,l)=>{let[s,g]=l.split(":"),u=i[s];if(!u)throw new Error(`Facet "${s}" not found in configuration. Add configuration to either facet_attributes or filter_attributes.`);let h=u.field,f=u.filterQuery||w;if(Q(u)){let p=c.find(d=>d.nested&&d.nested.path===u.nestedPath);return p?(p.nested.query.bool.should.push(f(`${u.nestedPath}.${u.field}`,g)),c):[...c,{nested:{inner_hits:{},path:u.nestedPath,query:{bool:{should:[f(`${u.nestedPath}.${u.field}`,g)]}}}}]}return[...c,f(h,g)]},[])}}];if(typeof a=="string"){let[c,l]=a.split(":"),s=i[c];if(!s)throw new Error(`Facet "${c}" not found in configuration. Add configuration to either facet_attributes or filter_attributes.`);let g=s.filterQuery||w;if(Q(s)&&s.nestedPath){let u=o.find(h=>h.nested&&h.nested.path===s.nestedPath+".");return u?(u.nested.query.bool.should.push(g(`${s.nestedPath}.${s.field}`,l)),o):[...o,{nested:{inner_hits:{},path:s.nestedPath,query:{bool:{should:[g(`${s.nestedPath}.${s.field}`,l)]}}}}]}return[...o,g(s.field,l)]}},[])},E=(t=[],e=[],r)=>{let n=/([\w\.\-]+)\:/gi,i=R(t,e);return r.replace(n,(o,a)=>{if(!i[a])throw new Error(`Attribute "${a}" is not defined as an attribute in the facet or filter search settings`);if(i[a].nestedPath)throw new Error(`Attribute "${a}" is a nested field and cannot be used as a filter. Nested fields are supported in facetFilers or numericFilters.`);return i[a].field+":"})},L=(t,e)=>{let{params:r={}}=t,{filters:n}=r;return!n||n===""?[]:[{query_string:{query:E(e.facet_attributes,e.filter_attributes,n)}}]},z=(t,e)=>{if(!e.geo_attribute)return[];let{params:r={}}=t,{aroundLatLng:n,aroundRadius:i,insideBoundingBox:o}=r;if(o)return[Qe(o,e.geo_attribute)];if(n){let a=n.split(",");return[{geo_distance:{distance:i||"1000m",[e.geo_attribute]:{lat:a[0],lon:a[1]}}}]}return[]};function Qe(t,e){let r=(n,i,o,a)=>({geo_bounding_box:{[e]:{top_right:{lat:n,lon:i},bottom_left:{lat:o,lon:a}}}});if(typeof t=="string"){let[n,i,o,a]=t.split(",");return r(parseFloat(n),parseFloat(i),parseFloat(o),parseFloat(a))}else if(Array.isArray(t))return{bool:{should:t.map(i=>{let[o,a,c,l]=i;return r(parseFloat(o),parseFloat(a),parseFloat(c),parseFloat(l))})}}}function W(t,e){if(e.sorting&&Object.keys(e.sorting).length>0){let r=Object.keys(e.sorting).find(i=>{if(t.indexName.endsWith(i))return!0});if(!r&&!e.sorting.default)return{};let n=r?e.sorting[r]:e.sorting.default;return Array.isArray(n)?{sort:n.map(i=>({[i.field]:i.order}))}:{sort:{[n.field]:n.order}}}return{}}function U(t,e){if(e.sorting&&Object.keys(e.sorting).length>0){let r=Object.keys(e.sorting).find(n=>{if(t.endsWith(n))return!0});if(r)return t.replace(r,"")}return t}var _e=t=>{let e=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return e=e.split("").map(r=>/[a-z]/.test(r)?`[${r}${r.toUpperCase()}]`:r).join(""),e=`${e}.*`,t.length>2&&(e=`([a-zA-Z]+ )+?${e}`),e},xe=(t,e,r)=>{let n=r&&r.length>0?{include:_e(r)}:{};return{terms:{field:t,size:e,...n}}},$=(t,e,r)=>{let n={},i=typeof t!="string"&&t.facetQuery?t.facetQuery:xe,o=(a,c)=>(typeof t=="string"||t.type==="string"?n={[a]:i(c,e,r)}:t.type==="numeric"&&(n={[a+"$_stats"]:{stats:{field:c}},[a+"$_entries"]:i(c,e,r)}),n);return typeof t=="string"?o(t,t):Q(t)?{[`${t.nestedPath}.`]:{nested:{path:t.nestedPath},aggs:o(t.attribute,`${t.nestedPath}.${t.field}`)}}:o(t.attribute,t.field)},we=(t,e,r)=>{let{params:n={},type:i}=t,{facets:o,maxValuesPerFacet:a,facetName:c,facetQuery:l}=n,s=a||10,g=e.facet_attributes||[];if(c){let u=S(g,c);return u?$(u,s,l):null}else if(Array.isArray(o)){let u=e.facet_attributes||[];return r.facetAttributesOrder&&(u=r.facetAttributesOrder.map(f=>S(e.facet_attributes||[],f)).filter(f=>f!==null)),(o[0]==="*"?u:o.map(f=>S(e.facet_attributes||[],f)).filter(f=>f!==null)).reduce((f,p)=>(0,J.default)(f,$(p,s,"")),{})||{}}else if(typeof o=="string"){let u=S(e.facet_attributes||[],o);return u?$(u,s,""):{}}};function Ce(t,e){return e.touched?{function_score:{query:{pinned:{ids:e.pinnedDocs,organic:t}},functions:e.boostFunctions}}:t}function Ee(t,e){let r=n=>e.map(i=>typeof i=="string"?i:`${i.field}^${(i.weight||1)*n}`);return{bool:{should:[{bool:{should:[{multi_match:{query:t,fields:r(1),fuzziness:"AUTO:4,8"}},{multi_match:{query:t,fields:r(.5),type:"bool_prefix"}}]}},{multi_match:{query:t,type:"phrase",fields:r(2)}}]}}}var Pe=(t,e,r,n)=>{var f,p,d;let i=r.query,o=e.search_attributes,a=[...D(t,e),...O(t,e),...L(t,e),...z(t,e),...((f=n==null?void 0:n.getBaseFilters)==null?void 0:f.call(n))||[],...r.baseFilters],c=typeof i=="string"&&i!==""?n!=null&&n.getQuery?n.getQuery(i,o,e):Ee(i,o):{match_all:{}},l=typeof(n==null?void 0:n.getKnnQuery)=="function",s=((p=n==null?void 0:n.getQuery)==null?void 0:p.call(n,i,o,e))===!1;(s||l&&i==="")&&(c={match_all:{}});let g={bool:{filter:a,must:r.touched?Ce(c,r):c}},u=null;if(l&&i!==""&&(u={filter:a,...((d=n==null?void 0:n.getKnnQuery)==null?void 0:d.call(n,i,o,e))||{}}),i!==""&&s&&l&&u)return{knn:u};let h=K(t);return{query:g,knn:u||void 0,rank:l&&!s&&h>0&&i!==""?{rrf:{window_size:h}}:void 0}},K=t=>{let{params:e={}}=t;return e.hitsPerPage==null?20:e.hitsPerPage},Me=(t,e)=>{let{params:r={}}=t,n=K(t);return{size:n,from:(r.page||0)*n}},Re=(t,e)=>{let{params:r={}}=t,{attributesToRetrieve:n}=r,i=new Set([...e.result_attributes||[],...e.highlight_attributes||[],...e.geo_attribute?[e.geo_attribute]:[]]),a=Object.keys(e.runtime_mappings||{}).reduce((c,l)=>{var s;return(s=e.result_attributes)!=null&&s.includes(l)?[l,...c]:c},[]);return{_source:{includes:Array.from(i)},...a.length>0?{fields:a}:{}}},P=t=>{let e={attribute:t,length:100};if(!t.includes(":"))return e;let r=t.match(/(.+)\:(\d+)/);return r?{attribute:r[1],length:parseInt(r[2])}:e},$e=(t,e)=>{var a,c;let{params:r={}}=t,{attributesToHighlight:n}=r,i=((a=e.highlight_attributes)==null?void 0:a.reduce((l,s)=>({...l,[s]:{number_of_fragments:0}}),{}))||{},o=((c=e.snippet_attributes)==null?void 0:c.reduce((l,s)=>({...l,[P(s).attribute]:{number_of_fragments:5,fragment_size:P(s).length}}),{}))||{};return Object.keys(i).length===0&&Object.keys(o).length===0?{}:{highlight:{pre_tags:["<em>"],post_tags:["</em>"],fields:{...i,...o}}}},ke=(t,e)=>e.runtime_mappings?{runtime_mappings:e.runtime_mappings}:{};function V(t,e,r,n){return{aggs:we(t,e,r),...Pe(t,e,r,n),...Me(t,e),...Re(t,e),...$e(t,e),...W(t,e),...ke(t,e)}}function G(t,e){let r=new RegExp(e,"gi");return t.replace(r,n=>`<em>${n}</em>`)}function Te(t,e){return e.findIndex(r=>{if(r.indexOf("*")<0)return r===t;let n=r.replace(/[.+?^$|\{\}\(\)\[\]\\]/g,"\\$&");return new RegExp(`^${n.replace(/\*/g,".*")}$`).test(t)})>=0}function k(t,e="<ais-highlight-0000000000>",r="<ais-highlight-0000000000/>",n=[]){let{_source:i={},highlight:o={}}=t,a={...i,...o},c=n.map(s=>P(s).attribute);return Object.keys(a).reduce((s,g)=>{let u=i[g],h=o[g]||null;if(!Te(g,c))return s;if(Array.isArray(u)&&!h)return{...s,[g]:u.map(f=>({matchLevel:"none",matchedWords:[],value:f.toString()}))};if(Array.isArray(u)&&h&&Array.isArray(h))return{...s,[g]:h.map(f=>({fullyHighlighted:!1,matchLevel:"full",matchedWords:Array.from(f.matchAll(/\<em\>(.*?)\<\/em\>/g)).map(d=>d[1]),value:f.toString().replace(/\<em\>/g,e).replace(/\<\/em\>/g,r)}))};if(!Array.isArray(u)&&h&&Array.isArray(h)||!u&&Array.isArray(h)&&h.length>0){let f=h[0],d={fullyHighlighted:!1,matchLevel:"full",matchedWords:Array.from(f.matchAll(/\<em\>(.*?)\<\/em\>/g)).map(y=>y[1]),value:f.toString().replace(/\<em\>/g,e).replace(/\<\/em\>/g,r)};return{...s,[g]:d}}return{...s,[g]:{matchLevel:"none",matchedWords:[],value:u!=null?u.toString():""}}},{})}var je=(t,e,r)=>{let{hits:n}=t,{highlight_attributes:i=[],snippet_attributes:o=[]}=e;return n.hits.map(a=>{var c,l,s,g,u,h;return{objectID:a._id,_index:a==null?void 0:a._index,...a._source||{},...a.fields||{},...a.inner_hits?{inner_hits:a.inner_hits}:{},...i.length>0?{_highlightResult:k(a,(c=r==null?void 0:r.params)==null?void 0:c.highlightPreTag,(l=r==null?void 0:r.params)==null?void 0:l.highlightPostTag,i)}:{},...o.length>0?{_snippetResult:k(a,(s=r==null?void 0:r.params)==null?void 0:s.highlightPreTag,(g=r==null?void 0:r.params)==null?void 0:g.highlightPostTag,e.snippet_attributes)}:{},...e.geo_attribute&&((u=a._source)==null?void 0:u[e.geo_attribute])?{_geoloc:ve((h=a._source)==null?void 0:h[e.geo_attribute])}:{}}})};function ve(t){if(typeof t=="string"){let[e,r]=t.split(",").map(n=>parseFloat(n));return{lat:e,lng:r}}else{if(Array.isArray(t))return{lat:t[0],lng:t[1]};if(typeof t=="object"&&"lat"in t&&"lon"in t)return{lat:parseFloat(t.lat),lng:parseFloat(t.lon)}}return null}var Ne=(t,e)=>{if(!(t!=null&&t.aggregations))return{};let r=Object.keys(t.aggregations).reduce((n,i)=>{let o=(t.aggregations||{})[i];if(i.endsWith(".")){let{doc_count:a,...c}=o;return{...n,...c}}return{...n,[i]:o}},{});return Object.keys(r).reduce((n,i)=>{let o=i.split("$")[0];if(H(e.facet_attributes||[],o)==="numeric"){let l=r[o+"$_stats"],{buckets:s}=r[o+"$_entries"];return{...n,facets:{...n.facets,[o]:s.reduce((g,u)=>({...g,[u.key]:u.doc_count}),{})},facets_stats:{...n.facets_stats,[o]:{min:l.min,avg:l.avg,max:l.max,sum:l.sum}}}}let{buckets:c}=r[o];return{...n,facets:{...n.facets,[o]:c.reduce((l,s)=>({...l,[s.key]:s.doc_count}),{})}}},{facets:{},facets_stats:{}})},Be=(t,e)=>{var n,i;let r=(n=t.facet_attributes)==null?void 0:n.map(o=>typeof o=="string"?o:o.attribute);return{renderingContent:{facetOrdering:{facets:{order:e.facetAttributesOrder||r||[]},values:(i=t.facet_attributes)==null?void 0:i.reduce((o,a)=>{let c=typeof a=="string"?a:a.attribute;return e.facetAttributesOrder&&!e.facetAttributesOrder.includes(c)?o:{...o,[c]:{sortRemainingBy:"count"}}},{})}}}},Ie=(t,e,r)=>{let{params:n={}}=e,{hitsPerPage:i=20,page:o=0}=n,{total:a}=t.hits,c=typeof a=="number"?a:a==null?void 0:a.value,l=i<=0?0:Math.ceil((typeof a=="number"?a:(a==null?void 0:a.value)||0)/i);return{hitsPerPage:i,processingTimeMS:t.took,nbHits:c,page:o,nbPages:l,query:r.query}};function T(t,e,r,n){try{return{appliedRules:n.ruleIds,exhaustiveNbHits:!0,exhaustiveFacetsCount:!0,exhaustiveTypo:!0,exhaustive:{facetsCount:!0,nbHits:!0,typo:!0},...Ie(t,e,n),...Be(r,n),...Ne(t,r),hits:je(t,r,e),index:e.indexName,params:new URLSearchParams(e.params).toString(),...n.userData.length>0?{userData:n.userData}:{}}}catch{throw new Error("Error transforming Elasticsearch response for index")}}var Y=(t,e)=>{var c,l,s;let r=t.aggregations||{},n=(c=e==null?void 0:e.params)==null?void 0:c.facetName,i=((l=e.params)==null?void 0:l.highlightPreTag)||"<ais-highlight-0000000000>",o=((s=e.params)==null?void 0:s.highlightPostTag)||"<ais-highlight-0000000000/>",a=r[Object.keys(r)[0]];return a&&a[n]&&(a=a[n]),{facetHits:a.buckets.map(g=>({value:g.key,highlighted:G(g.key,e.params.facetQuery||"").replace(/<\em>/g,i).replace(/<\/\em>/g,o),count:g.doc_count})),exhaustiveFacetsCount:!0,processingTimeMS:t.took}};var He=t=>typeof btoa>"u"?Buffer.from(t.username+":"+t.password).toString("base64"):btoa(t.username+":"+t.password);function Oe(t){let e;return typeof atob>"u"?e=Buffer.from(t.split(":")[1],"base64").toString():e=atob(t.split(":")[1]).split("$"),`https://${e[1]}.${e[0]}`}var _=class{constructor(e,r){this.config=e;this.settings=r}createElasticsearchQueryFromRequest(e){return C(e)}async performNetworkRequest(e){if(this.config.host===void 0&&this.config.cloud_id===void 0)throw new Error("No Elasticsearch host or cloud_id specified. Please provide a host or cloud id in your Searchkit configuration.");let r=this.config.cloud_id?Oe(this.config.cloud_id):this.config.host;return fetch(`${r}/_msearch`,{headers:{...this.config.apiKey?{authorization:`ApiKey ${this.config.apiKey}`}:{},"content-type":"application/json",...this.config.headers||{},...this.config.auth?{Authorization:"Basic "+He(this.config.auth)}:{}},body:this.createElasticsearchQueryFromRequest(e),method:"POST"})}async msearch(e){var r,n,i,o,a,c;try{let s=await(await this.performNetworkRequest(e)).json();if(this.settings.debug&&(console.log("Elasticsearch response:"),console.log(JSON.stringify(s))),s.status>=500)throw console.error(JSON.stringify(s)),new Error("Elasticsearch Internal Error: Check your elasticsearch instance to make sure it can recieve requests.");if(s.status===401)throw console.error(JSON.stringify(s)),new Error("Cannot connect to Elasticsearch. Check your connection host and auth details (username/password or API Key required). You can also provide a custom Elasticsearch transporter to the API Client. See https://www.searchkit.co/docs/guides/setup-elasticsearch#connecting-with-usernamepassword for more details.");if(((n=(r=s.responses)==null?void 0:r[0])==null?void 0:n.status)===403)throw console.error(JSON.stringify(s)),new Error("Auth Error: You do not have permission to access this index. Check you are calling the right index (specified in frontend) and your API Key permissions has access to the index.");if(s.status===404||((o=(i=s.responses)==null?void 0:i[0])==null?void 0:o.status)===404)throw console.error(JSON.stringify(s)),new Error("Elasticsearch index not found. Check your index name and make sure it exists.");if(s.status===400||((c=(a=s.responses)==null?void 0:a[0])==null?void 0:c.status)===400)throw console.error(JSON.stringify(s)),new Error(`Elasticsearch Bad Request. 
          
          1. Check your query and make sure it is valid. 
          2. Check the field mapping. See documentation to make sure you are using text types for searching and keyword fields for faceting
          3. Turn on debug mode to see the Elasticsearch query and the error response.
          `);return s.responses}catch(l){throw l}}};var Z=t=>{if(!t)return[];if(typeof t=="string"){let[e,r]=t.split(":");return[{attribute:e,value:r}]}else return t.reduce((e,r)=>{if(typeof r=="string"){let[n,i]=r.split(":");return[...e,{attribute:n,value:i}]}return[...e,...Z(r)]},[])},X=(t,e,r)=>{var a,c,l;let n={query:((a=e.params)==null?void 0:a.query)||"",context:((c=e.params)==null?void 0:c.ruleContexts)||[],filters:Z((l=e.params)==null?void 0:l.facetFilters)},i=De(n,t||[]);return i.reduce((s,g)=>(g.actions.map(u=>{s.touched=!0,u.action==="PinnedResult"?s.pinnedDocs.push(...u.documentIds):u.action==="QueryRewrite"?s.query=u.query:u.action==="QueryBoost"?s.boostFunctions.push({filter:{query_string:{query:E(r.facet_attributes,r.filter_attributes,u.query)}},weight:u.weight}):u.action==="RenderUserData"?s.userData.push(JSON.parse(u.userData)):u.action==="RenderFacetsOrder"?s.facetAttributesOrder=u.facetAttributesOrder:u.action==="QueryFilter"&&s.baseFilters.push({query_string:{query:E(r.facet_attributes,r.filter_attributes,u.query)}})}),s),{ruleIds:i.map(s=>s.id),pinnedDocs:[],boostFunctions:[],query:n.query,userData:[],facetAttributesOrder:void 0,touched:!1,baseFilters:[]})},De=(t,e)=>e.filter(r=>r.conditions.find(n=>n.filter(i=>i.context==="query"&&i.match_type==="exact"?i.value===t.query:i.context==="query"&&i.match_type==="contains"?t.query.includes(i.value):i.context==="query"&&i.match_type==="prefix"?t.query.startsWith(i.value):i.context==="context"?i.value.some(o=>t.context.includes(o)):i.context==="filterPresent"?i.values.every(o=>t.filters.find(a=>a.attribute===o.attribute&&a.value===o.value)!==void 0):!1).length===n.length)!==void 0);var M=class{constructor(e,r={debug:!1}){this.config=e;this.settings=r;this.transporter="msearch"in e.connection?e.connection:new _(e.connection,r)}async performSearch(e){try{return this.settings.debug&&(console.log("Performing search with requests:"),console.log("POST /_msearch"),console.log(C(e))),await this.transporter.msearch(e)}catch(r){return console.error(r),[]}}async handleInstantSearchRequests(e,r){var c,l;if(!e||Array.isArray(e)===!1)throw console.log({instantsearchRequests:e}),new Error("No instantsearch requests provided. Check that the data you are providing from API request is correct. Likely you are not passing the request body correctly, its still a JSON string or the API is not a POST request.");let n=this.config.search_settings.query_rules||[],i=e.map(s=>X(n,s,this.config.search_settings)),o=e.map((s,g)=>({body:V(s,this.config.search_settings,i[g],r),request:s,indexName:U(s.indexName,this.config.search_settings)}));(c=r==null?void 0:r.hooks)!=null&&c.beforeSearch&&(o=await r.hooks.beforeSearch(o));let a=await this.performSearch(o);(l=r==null?void 0:r.hooks)!=null&&l.afterSearch&&(a=await r.hooks.afterSearch(o,a));try{return{results:a.map((g,u)=>{var h;return(h=e[u].params)!=null&&h.facetName?Y(g,e[u]):T(g,e[u],this.config.search_settings,i[u])})}}catch(s){throw console.error(s),new Error("Error transforming response. Check the afterSearch hook function is correct. Likely you are not returning the correct response object.")}}};return oe(Le);})();
var Searchkit = SearchkitDefault.default
//# sourceMappingURL=index.global.js.map